<HTML>
<HEAD>
 <TITLE>Event-based programming example</TITLE>
 <SCRIPT type="text/javascript" src="../../Sources/yocto_api.js"></SCRIPT>
 <SCRIPT type="text/javascript" src="../../Sources/yocto_anbutton.js"></SCRIPT>
 <SCRIPT type="text/javascript" src="../../Sources/yocto_temperature.js"></SCRIPT>
 <SCRIPT type="text/javascript" src="../../Sources/yocto_lightsensor.js"></SCRIPT>
 <SCRIPT language='javascript1.5' type='text/JavaScript'>
 <!--
 function valueChangeCallBack(obj_fct, str_value)
 {
     // the field to update is stored in the function userData
     var spanId = obj_fct.get_userData();
     document.getElementById(spanId).innerHTML = str_value;
 }

 function deviceArrival(module)
 {
     var serial = module.get_serialNumber();
     var div = document.getElementById(serial);
     if(div != undefined) {
         div.style.display = "block";
         return;
     }
     var descr = "<div id='"+serial+"'>Module "+serial+":<br>";

     var fctcount = module.functionCount();
     var fctobjs = {};
     for (var i = 0; i < fctcount; i++)
     {
         var fctName = module.functionId(i);
         var fctFullName = module.get_serialNumber() + "." + fctName;

         if (fctName.indexOf("anButton")==0) { 
             descr += "- "+fctName+": <span id='"+fctFullName+"'></span><br>";
             fctobjs[fctFullName] = YAnButton.FindAnButton(fctFullName);
         }
         if (fctName.indexOf("temperature")==0) {
             descr += "- "+fctName+": <span id='"+fctFullName+"'></span> &deg;C<br>";
             fctobjs[fctFullName] = YTemperature.FindTemperature(fctFullName);
         }
         if (fctName.indexOf("lightSensor")==0) {
             descr += "- "+fctName+": <span id='"+fctFullName+"'></span> lux<br>";
             fctobjs[fctFullName] = YLightSensor.FindLightSensor(fctFullName);
         }
     }
     descr += "</div>";
     document.getElementById('modules').innerHTML += descr;

     // register callbacks
     for(var fctFullName in fctobjs) {
         var fct = fctobjs[fctFullName];
         fct.set_userData(fctFullName);
         fct.set_callback(valueChangeCallBack);
     }
 }

 function deviceRemoval(module)
 {
     var serial = module.get_serialNumber();
     document.getElementById(serial).style.display = "none";
 }

 function handleHotPlug()
 {
     YAPI.SetTimeout("handleHotPlug()",1000);
 }

 // Use explicit error handling rather than exceptions
 YAPI.DisableExceptions();

 // Setup the API to use the VirtualHub on local machine
 if(YAPI.RegisterHub('http://127.0.0.1:4444/') != YAPI.SUCCESS) {
     alert("Cannot contact VirtualHub on 127.0.0.1");
 }

 YAPI.RegisterDeviceArrivalCallback(deviceArrival);
 YAPI.RegisterDeviceRemovalCallback(deviceRemoval);
-->
 </SCRIPT>
</HEAD>  
<BODY onload='handleHotPlug();'>
 Connected modules:<br>
 <div id='modules'></div>
</BODY>
</HTML> 
